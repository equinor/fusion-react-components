import { Meta, Description, Story } from '@storybook/addon-docs';
import readme from '@equinor/fusion-react-observable/README.md';
import { ChangeLog, PackageInfo, StoryExample } from '../components';

<Meta title="Observables" />

<Description markdown={readme} />

<PackageInfo pkg={require('@equinor/fusion-react-observable/package.json')}/>

##

```ts
import { useMemo } from 'react';
import { filter, map, withLatestFrom } from 'rxjs/operators';
import { Action, Observable, useObservable, useObservableEffect } from '.';

type Logger = (message: string) => void;

type State = {
  foo: string;
};

type Actions = Action<'foo' | 'bar'>;

const foobar = (action$: Observable<Actions>, state$: Observable<State>, deps: { logger: Logger }) => {
  return action$.pipe(
    filter((a) => a.type === 'foo'),
    withLatestFrom(state$),
    map(([action, state]) => {
      deps.logger(action.type);
      return { type: 'bar', payload: `got ${state.foo} from foo` } as Actions;
    })
  );
};

const effects = [foobar];

const reducer = (state: State, _action: Actions) => {
  return state;
};

const initial: State = { foo: 'init' };

export const MyComp = () => {
  const subject = useObservable(reducer, initial);
  const deps = useMemo(
    () => ({
      logger: console.log,
    }),
    []
  );
  useObservableEffect(subject, effects, deps);
};

```